<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>langchain &amp; langgraph - colinder&#39;s blog</title><meta name="Description" content="Hello New World"><meta property="og:url" content="https://colinder.github.io/langchainnlanggraph/">
  <meta property="og:site_name" content="colinder&#39;s blog">
  <meta property="og:title" content="langchain & langgraph">
  <meta property="og:description" content="langchain과 langgraph를 실무개발하며 경함한 사항들을 기록합니다.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-02-20T20:30:49+09:00">
    <meta property="article:modified_time" content="2026-02-20T20:30:49+09:00">
    <meta property="article:tag" content="Langchain">
    <meta property="article:tag" content="Langgraph">
    <meta property="og:image" content="https://colinder.github.io/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://colinder.github.io/logo.png">
  <meta name="twitter:title" content="langchain & langgraph">
  <meta name="twitter:description" content="langchain과 langgraph를 실무개발하며 경함한 사항들을 기록합니다.">
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://colinder.github.io/langchainnlanggraph/" /><link rel="prev" href="https://colinder.github.io/vscode_lint/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="colinder" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "langchain \u0026 langgraph",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/colinder.github.io\/langchainnlanggraph\/"
        },"genre": "posts","keywords": "langchain, langgraph","wordcount":  4249 ,
        "url": "https:\/\/colinder.github.io\/langchainnlanggraph\/","datePublished": "2026-02-20T20:30:49+09:00","dateModified": "2026-02-20T20:30:49+09:00","license": "colinder","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "colinder"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="auto" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="colinder&#39;s blog">Hello New World</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/categories/" title="대분류"> Categories </a><a class="menu-item" href="/posts/" title="게시글"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="검색할 내용을 입력해주세요" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="colinder&#39;s blog">Hello New World</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="검색할 내용을 입력해주세요" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/categories/" title="대분류">Categories</a><a class="menu-item" href="/posts/" title="게시글">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">langchain & langgraph</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>colinder</a></span>&nbsp;<span class="post-category">included in <a href="/categories/langchain/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Langchain</a>&nbsp;<a href="/categories/langgraph/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Langgraph</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2026-02-20">2026-02-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;4249 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#langchain--langgraph">LangChain &amp; LangGraph</a></li>
    <li><a href="#langchain">LangChain</a></li>
    <li><a href="#langgraph">LangGraph</a></li>
    <li><a href="#실제-개발-순서">실제 개발 순서</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-사용할-모델을-정의한다">1. 사용할 모델을 정의한다.</a></li>
            <li><a href="#2-state를-정의한다">2. state를 정의한다.</a></li>
            <li><a href="#3-대략적인-그래프-구조를-고안한-후-필요한-node를-정리한다">3. 대략적인 그래프 구조를 고안한 후 필요한 node를 정리한다.</a></li>
            <li><a href="#4-그래프를-정의하고-컴파일한다">4. 그래프를 정의하고 컴파일한다.</a></li>
            <li><a href="#5-checkpointer-설정한다">5. checkpointer 설정한다.</a></li>
            <li><a href="#6-api와-연동하여-ainvoke하여-사용한다">6. api와 연동하여 .ainvoke()하여 사용한다.</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#마무리">마무리</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="langchain--langgraph">LangChain &amp; LangGraph</h2>
<blockquote>
<p>대화형 주문 인공지능을 개발하면서, 사용했던 프레임워크인 LangChain &amp; Langgraph에 대하여 정리하고 사용방법을 정리한다.</p></blockquote>
<p>​</p>
<h2 id="langchain">LangChain</h2>
<p>LangChain은 대형 언어 모델(LLM)을 중심으로 한 애플리케이션을 쉽게 구성할 수 있도록 하는 프레임워크이다.</p>
<p>풀어서 말하면</p>
<ul>
<li>LLM을 <strong>API처럼 쓰는 것에 그치지 않고</strong></li>
<li>프롬프트, 도구, 메모리, 외부 데이터(RAG) 등을</li>
<li><strong>하나의 애플리케이션 구조로 묶어주는 추상화 계층</strong></li>
</ul>
<p>​</p>
<p>​</p>
<h2 id="langgraph">LangGraph</h2>
<p>LangGraph는 상태(State)를 기반으로 LLM 애플리케이션의 <b>실행 흐름을 그래프 구조로 정의</b>하기 위한 프레임워크이다. (여기서 중요한 키워드는 &ldquo;실행 흐름을 그래프 구조로 정의&rdquo;)</p>
<p>풀어서 말하면</p>
<ul>
<li>
<p>LLM 호출을 단순히 “한 번 실행”하는 게 아니라</p>
</li>
<li>
<p><strong>상태를 가진 프로세스</strong>로 보고</p>
</li>
<li>
<p>각 단계를 <strong>노드(Node)</strong>, 흐름을 <strong>엣지(Edge)</strong> 로 정의</p>
</li>
</ul>
<p>​</p>
<p>​</p>
<h2 id="실제-개발-순서">실제 개발 순서</h2>
<blockquote>
<p>실제 개발하는 데 진행했던 순서를 정리한다.</p></blockquote>
<ol>
<li>사용할 모델을 정의한다.</li>
<li>state를 정의한다.</li>
<li>대략적인 그래프 구조를 고안한 후 필요한 node를 정리한다.
<ul>
<li>단일 기능으로 동작?할 노드</li>
<li>should_continue로 분기할 노드</li>
</ul>
</li>
<li>그래프를 정의하고 컴파일한다.</li>
<li>checkpointer 설정한다.</li>
<li>api와 연동하여 .invoke()하여 사용한다.</li>
</ol>
<p>보통 이런 순서로 진행하면 크게 문제 없이 동작할 것이며, 큰 흐름은 이해할 수 있다. (다만 이 흐름과 상관 없이 데이터를 저장하고 관리해야 하는데 이는 redis를 사용하는 등 분산 처리 및 관리하는 것을 권장한다.)</p>
<p>​</p>
<p>​</p>
<h4 id="1-사용할-모델을-정의한다">1. 사용할 모델을 정의한다.</h4>
<blockquote>
<p>필자는 azure에 있는 모델을 사용했으며 이를 불러오는 방법 등은 아래 코드를 참고하면 되겠다.</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># models.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">AzureChatOpenAI</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">llm</span> <span class="o">=</span> <span class="n">AzureChatOpenAI</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">azure_deployment</span><span class="o">=</span><span class="s2">&#34;gpt-4o&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">api_version</span><span class="o">=</span><span class="s2">&#34;2024-08-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">api_key</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">AZURE_OPENAI_API_KEY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">azure_endpoint</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">AZURE_OPENAI_ENDPOINT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>여기서 중요한 값은 &ldquo;azure_deployment&rdquo;, &ldquo;api_version&quot;가 홈페이지에 등록된 내용과 정확히 일치해야 한다.</p>
<p>​</p>
<p>​</p>
<h4 id="2-state를-정의한다">2. state를 정의한다.</h4>
<blockquote>
<p>사실상 지금 단계에서 이를 완벽히 수행하기는 어렵다고 생각한다. 다만 어떤 값들을 주고 받을 것이며, 어떤 데이터 들을 다룰 것인지 미리 정의 한다고 생각. (경험상 반드시 구조가 강제되지는 않는 부분이다.)</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># schemas.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langgraph.graph</span> <span class="kn">import</span> <span class="n">MessagesState</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AgentSystemSchema</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    에이전트 전반에서 공통으로 참조하는 시스템 상태 정의
</span></span></span><span class="line"><span class="cl"><span class="s2">    (비즈니스 컨텍스트 및 시스템 고정 정보)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># LLM에게 전달되는 시스템 프롬프트</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">products</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 주문 가능한 상품 목록 (상품명, 가격, 옵션 등 비즈니스 정보)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">previous_orders</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 사용자의 이전 주문 내역 요약 정보</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 대화 맥락 유지 및 재주문/추천 판단에 활용</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AgentState</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    단일 대화 흐름에서 변경되며 누적되는 에이전트 실행 상태
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 가장 최근 사용자 또는 에이전트의 발화</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 전체 대화 이력</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 메시지 누적 관리 및 LLM 컨텍스트 제공 용도</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># messages가 과도하게 누적되는 것을 방지하기 위한</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 기존 대화 요약 정보 (컨텍스트 압축 목적)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">system</span><span class="p">:</span> <span class="n">AgentSystemSchema</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 시스템 전역 상태</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 대화 중 변경되지 않거나 드물게 변경되는 비즈니스/환경 정보</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>​</p>
<p>​</p>
<h4 id="3-대략적인-그래프-구조를-고안한-후-필요한-node를-정리한다">3. 대략적인 그래프 구조를 고안한 후 필요한 node를 정리한다.</h4>
<blockquote>
<p>node는 역할 기준으로 다음 두 가지로 구성하였다.</p>
<ol>
<li><strong>작업 수행 노드</strong>
<ul>
<li>단일 책임을 가지는 로직을 수행하며</li>
<li>state를 갱신하고 다음 단계로 전달할 결과를 반환한다.</li>
</ul>
</li>
<li><strong>분기 판단 노드 (should_continue)</strong>
<ul>
<li>현재 state를 기준으로</li>
<li>그래프의 실행 흐름을 제어한다.</li>
</ul>
</li>
</ol></blockquote>
<p>​</p>
<p>작업 수행 노드 예시</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">## 사용자의 발화가 주문인지 아닌지 판단</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">JsonOutputParser</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_core.prompts</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..llm.models</span> <span class="kn">import</span> <span class="n">llm</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..schemas</span> <span class="kn">import</span> <span class="n">AgentState</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">order_detection_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">당신은 사용자의 입력이 주문인지(혹은 주문의 수정, 삭제인지) 아닌지 판별하는 주문 판별 전문 AI 어시스턴트입니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">무조건 아래 schema를 준수해서 JSON 형태로 답을 해야 합니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">class OrderState(str, Enum):
</span></span></span><span class="line"><span class="cl"><span class="s2">    right_order = &#34;right_order&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    wrong_order = &#34;wrong_order&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    not_order = &#34;not_order&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">class OrderDetectionSchema(BaseModel):
</span></span></span><span class="line"><span class="cl"><span class="s2">    is_order: OrderState
</span></span></span><span class="line"><span class="cl"><span class="s2">    system_message: str
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">사용자 입력:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{messages}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">구매할 수 있는 제품목록:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{available_products}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">이전 주문 내역:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{previous_orders}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">주문 여부를 판단 기준
</span></span></span><span class="line"><span class="cl"><span class="s2">1. 제품명이 존재하는지?
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;사용자 입력&#39;에는 반드시 상품명과 수량이 포함되어 있어야 함
</span></span></span><span class="line"><span class="cl"><span class="s2">- 사용자는 공식 상품명을 그대로 쓰지 않고, 약어나 고유 키워드만으로 표현하는 경우가 많으므로 이 점을 반드시 고려할 것
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;유사한 상품명&#39;에 대한 정보와 반드시 비교해서 유사한 상품이 있는지 알아본 후 주문인지 아닌지 고려할 것.
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;제품 목록&#39;에 100% 일치하는 상품이 있는 경우, 이 상품을 주문하는 것으로 판단할 것
</span></span></span><span class="line"><span class="cl"><span class="s2">- 사용자가 입력한 상품명은 제공된 &#39;구매할 수 있는 제품목록&#39;과 반드시 연관성이 있어야 하며, 부분적으로 일치하거나 키워드 유사도(예: &#34;만두&#34;가 &#34;고기 만두&#34; 또는 &#34;김치 만두&#34;와 부분적으로 일치하는 경우)가 있다면, 정확히 일치하지 않아도 유효한 상품명으로 인식하세요. 유사한 제품이 복수일 때에도 주문으로 간주할 것
</span></span></span><span class="line"><span class="cl"><span class="s2">- 주문 여부 판단 시, 상품명이 매우 추상적일 수 있음을 염두에 두고, 연관성이 다소 낮더라도 제품 정보에 유사한 단어나 키워드가 있으면 &#39;주문&#39;을 한거라고 판단할 것
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">2. 수량이 존재하는지?
</span></span></span><span class="line"><span class="cl"><span class="s2">- 수량은 상품명에 직접 붙어 있을 수도 있고, 별도의 단위와 함께 숫자로 표기될 수도 있습니다. 단, 수량은 항상 정수로 표현됩니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">- 수량이 각각의 상품명 끝에 직접 붙어 있을 수 있으며, 이 경우 각 숫자를 해당 상품의 주문 수량으로 해석해야 합니다(예: &#34;갓김치1&#34;은 제품 &#39;갓김치 1개 주문&#39;, &#34;참이슬1&#34;은 제품 &#39;참이슬 1개 주문&#39;).
</span></span></span><span class="line"><span class="cl"><span class="s2">- 상품명 뒤에 공백 없이 숫자가 바로 따라오면(예: &#34;배추김치103&#34;), 그 숫자를 해당 상품의 주문 수량으로 해석해야 합니다. 즉, &#34;배추김치103&#34;은 상품명 &#34;배추김치&#34;에 수량 103개로 인식해야 합니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">- 수량은 1, 10, 100, 1000, 10000 이상도 가능하며, 이는 특이한 케이스가 아니고 수량을 의미한다고 판단할 것
</span></span></span><span class="line"><span class="cl"><span class="s2">- 이전 주문 내역(previous_orders)을 참고해서 주문 여부를 판단할 것. 이전 주문 내역과 유사한 형태로 입력했다면 이는 주문일 확률이 높습니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">- 주문할 수 없는 상품에 대한 주문으로 판단되면, 해당되는 상품 전체를 언급하며 다시 정확히 주문해달라고 system_message 필드에 작성해 주세요.
</span></span></span><span class="line"><span class="cl"><span class="s2">(ex. 말씀하신 </span><span class="si">{messages}</span><span class="s2">는 주문으로 판단되지 않습니다.)
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">주의사항
</span></span></span><span class="line"><span class="cl"><span class="s2">위 기준을 바탕으로 입력을 꼼꼼히 분석한 뒤, 주문이면 is_order 필드에 주어진 Enum에 맞는 값으로 반환해주세요.
</span></span></span><span class="line"><span class="cl"><span class="s2">is_order에는 &lt;class &#39;str&#39;&gt;타입의 &#39;right_order&#39;, &#39;wrong_order&#39;, &#39;not_order&#39; 이외에는 어떤 값도 들어갈 수 없습니다. 또 다른 어떤 문자나 특수문자를 추가하지 마세요. 꼭 &lt;class &#39;str&#39;&gt;로 값이 들어와야 합니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">system_message에는 &lt;class &#39;str&#39;&gt; 타입으로 반환해야 합니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">당부사항
</span></span></span><span class="line"><span class="cl"><span class="s2">❗system_message에는 사용자의 입력을 왜 주문으로 판단했는지, 어떤 상품 정보를 비교했는지, 어떤 상품에 유사하다고 판단했는지, 상품명과 수량이 잘 표시되었는지, 결과적으로 왜 주문으로 판단했는지 그 근거를 반드시 한글로 작성해 주세요.
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">is_order_should_continue</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&#34;messages&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">available_products</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">state</span><span class="p">[</span><span class="s2">&#34;system&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;buyer_info_for_order&#34;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;products_info&#34;</span><span class="p">,</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">rag_chain</span> <span class="o">=</span> <span class="n">order_detection_prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">JsonOutputParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">answer</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rag_chain</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;messages&#34;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;available_products&#34;</span><span class="p">:</span> <span class="n">available_products</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;previous_orders&#34;</span><span class="p">:</span> <span class="n">previous_orders</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;similar_products&#34;</span><span class="p">:</span> <span class="n">similar_products</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&#34;is_order&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;right_order&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;order_parser&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&#34;is_order&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;wrong_order&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;wrong_order_parser&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">answer</span><span class="p">[</span><span class="s2">&#34;is_order&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;not_order&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;invite_branch&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;safe_exit&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>여기서 라인별로 중요한? 부분이 있는데</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">rag_chain</span> <span class="o">=</span> <span class="n">order_detection_prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">JsonOutputParser</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>이 부분은 LangChain의 <strong>Runnable 조합 모델</strong>을 사용하는 핵심 로직이다.  Prompt, LLM, OutputParser를 각각 독립적인 Runnable로 정의한 뒤,  이를 파이프라인 형태로 합성하여 하나의 실행 단위(chain)로 구성한다.</p>
<p>먼저 Prompt와 OutputParser를 통해 <strong>LLM의 출력 형식을 명확히 정의</strong>한 뒤,  그 결과를 해석하여 **다음에 실행할 노드를 return 값으로 결정한다. ** LangGraph는 이 return 값을 기준으로 그래프 상의 다음 노드로 상태를 전달한다.</p>
<p>다음, should_continue 노드 예시를 보자.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># is_invite_should_continue.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_core.prompts</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langgraph.graph</span> <span class="kn">import</span> <span class="n">END</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..llm.models</span> <span class="kn">import</span> <span class="n">llm</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..schemas</span> <span class="kn">import</span> <span class="n">AgentState</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.utils.boolean_output_parser</span> <span class="kn">import</span> <span class="n">BooleanOutputParser</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">invite_detection_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">사용자 입력:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{messages}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">- 입력된 문자열은 반드시 6자리여야 하며, 오직 숫자 0부터 9까지의 숫자로만 이루어져 있어야 합니다.  
</span></span></span><span class="line"><span class="cl"><span class="s2">- 띄어쓰기, 한글, 영어, 특수문자, 기타 어떤 문자도 포함되어 있으면 안 됩니다.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">반환 값 조건:
</span></span></span><span class="line"><span class="cl"><span class="s2">- 출력은 반드시  &lt;class &#39;bool&#39;&gt; 타입의 True 또는 False 만 반환하세요.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">예시:
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;495038&#39; → True  
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;000123&#39; → True  
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;67384&#39; → False (5자리)  
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;1234567&#39; → False (7자리 이상)  
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;123 456&#39; → False (띄어쓰기 포함)  
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;ABC123&#39; → False (영어 포함)  
</span></span></span><span class="line"><span class="cl"><span class="s2">- &#39;123!@#&#39; → False (특수문자 포함)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">is_invite_should_continue</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&#34;messages&#34;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">rag_chain</span> <span class="o">=</span> <span class="n">invite_detection_prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">BooleanOutputParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rag_chain</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">({</span><span class="s2">&#34;messages&#34;</span><span class="p">:</span> <span class="n">messages</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;invite_parser&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">END</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>비교적 간단한다. 상위 단계에서 사용자의 발화가 주문인지 아닌지 판단한 후 만약 주문이 아니라면 초대코르를 입력한 것인지 판단하기 위한 코드이다.</p>
<p>​</p>
<p>여기까지 봤다면 어느정도 감이 올 것인데, 간단히 <b>LangChain은 “무엇을 판단할지”, LangGraph는 “어디로 흐를지”를 담당한다.</b></p>
<p>사실 이 단계와 그래프를 빌드 하는건 거의 동시에 수행된다. 왜냐하면 노드 자체에 이런 흐름을 정의해야 하고, 이 정의에 맞게 그래프를 빌드하기 때문이다.</p>
<p>​</p>
<p>​</p>
<h4 id="4-그래프를-정의하고-컴파일한다">4. 그래프를 정의하고 컴파일한다.</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># graph.builder.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langgraph.checkpoint.memory</span> <span class="kn">import</span> <span class="n">MemorySaver</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langgraph.graph</span> <span class="kn">import</span> <span class="n">END</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">StateGraph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..nodes</span> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">init_order</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">invite_branch</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">invite_parser</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_invite_should_continue</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_order_should_continue</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">order_confirm_should_continue</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">order_parser</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..schemas</span> <span class="kn">import</span> <span class="n">AgentState</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## graph_builder 설정 - node 추가</span>
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">AgentState</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&#34;invite_branch&#34;</span><span class="p">,</span> <span class="n">invite_branch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&#34;invite_parser&#34;</span><span class="p">,</span> <span class="n">invite_parser</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&#34;init_order&#34;</span><span class="p">,</span> <span class="n">init_order</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## graph_builder 설정 - edge 추가</span>
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">START</span><span class="p">,</span> <span class="n">order_confirm_should_continue</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;update_messages&#34;</span><span class="p">,</span> <span class="s2">&#34;init_order&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&#34;update_messages&#34;</span><span class="p">,</span> <span class="s2">&#34;retrieve&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&#34;retrieve&#34;</span><span class="p">,</span> <span class="s2">&#34;similar_products&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">graph_builder</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;similar_products&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_order_should_continue</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="s2">&#34;order_parser&#34;</span><span class="p">,</span> <span class="s2">&#34;wrong_order_parser&#34;</span><span class="p">,</span> <span class="s2">&#34;invite_branch&#34;</span><span class="p">,</span> <span class="s2">&#34;safe_exit&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>대략 이런 식으로 구성한다.</p>
<p>​</p>
<p>​</p>
<h4 id="5-checkpointer-설정한다">5. checkpointer 설정한다.</h4>
<p>checkpointer는 LangGraph 실행 중의 state를 저장하고 복구하기 위한 상태 저장 장치다.</p>
<p>조금 풀면,</p>
<ul>
<li>그래프 실행 도중</li>
<li>각 노드가 끝날 때마다</li>
<li><strong>현재 state를 외부 저장소에 기록</strong>해 두는 역할</li>
</ul>
<p>만약 이 설정이 없다면, 인공지능은 &ldquo;대화&quot;를 기억하고 답변하는 게 아니라 당장의 사용자 발화만을 인식하게 될 것인다.</p>
<p>​</p>
<p>해당 설정은 매우 간단하다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langgraph.checkpoint.memory</span> <span class="kn">import</span> <span class="n">MemorySaver</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.graph.builder</span> <span class="kn">import</span> <span class="n">graph_builder</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># langgraph 체크포인터 설정(히스토리 모드를 위해 사용)</span>
</span></span><span class="line"><span class="cl"><span class="n">checkpointer</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># langgraph 그래프 컴파일</span>
</span></span><span class="line"><span class="cl"><span class="n">graph</span> <span class="o">=</span> <span class="n">graph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>이렇게 그래프를 컴파일할 때 인자로 넣어주면 된다.</p>
<p>​</p>
<p>​</p>
<h4 id="6-api와-연동하여-ainvoke하여-사용한다">6. api와 연동하여 .ainvoke()하여 사용한다.</h4>
<p>사용은 더 간단하다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">httpx</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">APIRouter</span><span class="p">,</span> <span class="n">Request</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_core.messages</span> <span class="kn">import</span> <span class="n">HumanMessage</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langgraph.checkpoint.memory</span> <span class="kn">import</span> <span class="n">MemorySaver</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.graph.builder</span> <span class="kn">import</span> <span class="n">graph_builder</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">order_ai_router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># langgraph 체크포인터 설정(히스토리 모드를 위해 사용)</span>
</span></span><span class="line"><span class="cl"><span class="n">checkpointer</span> <span class="o">=</span> <span class="n">MemorySaver</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># langgraph 그래프 컴파일</span>
</span></span><span class="line"><span class="cl"><span class="n">graph</span> <span class="o">=</span> <span class="n">graph_builder</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">checkpointer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">get_ai_response</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plusfriend_user_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;configurable&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;thread_id&#34;</span><span class="p">:</span> <span class="n">user_pk</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">graph</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;plusfriend_user_key&#34;</span><span class="p">:</span> <span class="n">plusfriend_user_key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><p>이런 식으로 컴파일된 값들을 가지고와서 .ainvoke() 혹은 .invoke()을 해서 추론한 값을 그대로 return 해주면 된다.</p>
<p><strong><code>.invoke()</code></strong> → 동기 실행 (blocking)</p>
<p><strong><code>.ainvoke()</code></strong> → 비동기 실행 (<code>async/await</code>)</p>
<p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>
<h2 id="마무리">마무리</h2>
<p>해당 구조를 활용해 RAG나 프롬프트 엔지니어링 등 다양한 기법을 적용할 수 있으니 큰 흐름과 구조만 잘 알아두자.</p>
<p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2026-02-20</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/langchainnlanggraph/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/langchain/">Langchain</a>,&nbsp;<a href="/tags/langgraph/">Langgraph</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/vscode_lint/" class="prev" rel="prev" title="내가 쓰는 vscode lint 설정"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>내가 쓰는 vscode lint 설정</a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.143.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2020 - 2026</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">colinder</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/css/_custom.scss"><script type="text/javascript" src="https://colinder-github-io.disqus.com/embed.js" defer></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":200},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
